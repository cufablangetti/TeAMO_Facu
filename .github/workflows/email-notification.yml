name: Simple Notification

on:
  push:
    branches: [ main ]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Get commit info
      id: commit
      run: |
        echo "message=$(git log -1 --pretty=format:'%s')" >> $GITHUB_OUTPUT
        echo "author=$(git log -1 --pretty=format:'%an')" >> $GITHUB_OUTPUT
        echo "date=$(date '+%d/%m/%Y a las %H:%M')" >> $GITHUB_OUTPUT

    - name: Print notification (for testing)
      run: |
        echo "ğŸš€ PÃGINA ACTUALIZADA ğŸš€"
        echo "ğŸ“ Cambio: ${{ steps.commit.outputs.message }}"
        echo "ğŸ‘¤ Por: ${{ steps.commit.outputs.author }}"
        echo "ğŸ• Fecha: ${{ steps.commit.outputs.date }}"
        echo "ğŸ”— Link: https://te-amo-facu.vercel.app/"
        echo ""
        echo "âœ‰ï¸ Email que se enviarÃ­a:"
        echo "Para: facublangettit@gmail.com"
        echo "Asunto: ğŸš€ Â¡PÃ¡gina Te Amo Facu actualizada!"
        echo ""
        echo "Â¡Hola Coti! ğŸ’•"
        echo ""
        echo "Facu acaba de actualizar la pÃ¡gina especial para ti."
        echo ""
        echo "ğŸ“ Ãšltimo cambio: ${{ steps.commit.outputs.message }}"
        echo "ğŸ‘¤ Actualizado por: ${{ steps.commit.outputs.author }}"
        echo "ğŸ• Fecha: ${{ steps.commit.outputs.date }}"
        echo ""
        echo "âœ¨ Ve los cambios aquÃ­: https://te-amo-facu.vercel.app/"
        echo ""
        echo "ğŸ’¡ Tip: Refresca la pÃ¡gina (Ctrl+F5) para ver los nuevos cambios."
        echo ""
        echo "Con amor desde Argentina ğŸ‡¦ğŸ‡· â¤ï¸"

    - name: Send simple HTTP request
      run: |
        # Esto al menos confirma que el workflow funciona
        curl -s "https://httpbin.org/post" \
        -X POST \
        -H "Content-Type: application/json" \
        -d '{
          "event": "page_updated",
          "email_to": "facublangettit@gmail.com",
          "subject": "ğŸš€ PÃ¡gina Te Amo Facu actualizada",
          "commit": "${{ steps.commit.outputs.message }}",
          "author": "${{ steps.commit.outputs.author }}",
          "date": "${{ steps.commit.outputs.date }}",
          "url": "https://te-amo-facu.vercel.app/"
        }' || echo "Request failed but workflow continues"
